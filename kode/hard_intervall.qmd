---
title: "Hard intervall"
author: "Simen Løkken"
format: html
editor: visual
---

### Tema

Her ligger all koden fra dataanalysen til den tredje økta, dvs. den harde intervallen både kaldt og varmt.

```{r setup, include=FALSE}

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)
```

#### **Last inn pakker og tema**

```{r}

library(tidyverse)
library(ggtext)
library(patchwork)

theme_set(theme_bw())
```

#### **Datarydding**

Disse dataene er ryddet for dere.

```{r}

# Kald økt

hard_intervall_kald <- hard_intervall_kald %>%
  mutate(
    interval = as.factor(case_when(
      time < (13.40 * 60) ~ 0,
      time > (13.40 * 60) & time < (18.40 * 60) ~ 1,
      time > (21.10 * 60) & time < (26.10 * 60) ~ 2,
      time > (28.10 * 60) & time < (33.10 * 60) ~ 3,
      time > (35.10 * 60) & time < (40.10 * 60) ~ 4)
    )
  ) |> 
  select(time, heartrate, watts, temperature, interval)

# Varm økt

hard_intervall_varm <- hard_intervall_varm |> 
  mutate(
    temperature = "varm",
    interval = as.factor(case_when(
      time < (15.5 * 60) ~ 0,
      time > (15.5 * 60) & time < (20.5 * 60) ~ 1,
      time > (22 * 60) & time < (27 * 60) ~ 2,
      time > (28.5 * 60) & time < (33.5 * 60) ~ 3,
      time > (35 * 60) & time < (40 * 60) ~ 4,
      time > (41.5 * 60) & time < (46.5 * 60) ~ 5,
      time > (48 * 60) & time < (53 * 60) ~ 6)
    )
  ) |> 
  select(time, heartrate, watts, temperature, interval)

# Slå sammen

hard_intervall_kald_varm <- rbind(hard_intervall_kald, hard_intervall_varm)

# Lagre datasett

setwd("C:/Users/simen/Desktop/hvgs_des_2023/data")

write_csv(x = hard_intervall_varm, file = "hard_intervall_varm.csv")
write_csv(x = hard_intervall_kald, file = "hard_intervall_kald.csv")
write_csv(x = hard_intervall_kald_varm, file = "hard_intervall_kald_varm.csv")
```

#### **Plott**

```{r}

# Puls som funksjon av tid

p1 <- hard_intervall_kald %>%
  ggplot(aes(x = time, y = heartrate)) +
  geom_line(color = "dodgerblue", alpha = 0.8) +
  scale_x_continuous(name = NULL) + 
  scale_y_continuous(name = "Puls (slag/min)") +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    plot.title = element_text(size = 10),
    plot.subtitle = element_markdown(size = 8),
    axis.title = element_text(size = 10),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_text(size = 8)
  )

p2 <- hard_intervall_varm |> 
  ggplot(aes(x = time, y = heartrate)) +
  geom_line(color = "red", alpha = 0.8) +
  scale_x_continuous(name = "Tid (sekunder)") +
  scale_y_continuous(name = "Puls (slag/min)") +
   theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    plot.title = element_text(size = 10),
    plot.subtitle = element_markdown(size = 8),
    axis.title = element_text(size = 10),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_text(size = 8)
  )

intervall_sammenligning_terskel_hard <- p1 / p2

intervall_sammenligning_terskel_hard
```

```{r}

# Lagre plott

setwd("C:/Users/simen/Desktop/hvgs_des_2023/grafer")

ggsave(intervall_sammenligning_terskel_hard,
       filename = "intervall_sammenligning_terskel_hard.jpg",
       dpi = 300,
       height = 4,
       width = 7)
```

Watt- og pulsfordeling for hvert intervalldrag med både vanlig og split-fiolinplott

```{r}

# Lagre plott

setwd("C:/Users/simen/Desktop/hvgs_des_2023/grafer")

ggsave(hard_intervall_watt_puls_fordeling,
       filename = "hard_intervall_watt_puls_fordeling.jpg",
       dpi = 300,
       height = 5,
       width = 6)
```

```{r}

library(introdataviz)

# Puls

p5 <- hard_intervall_kald_varm |> 
  filter(interval != 6 & interval != 5 & interval != 0) |> 
  drop_na() |> 
  ggplot(aes(interval, heartrate, fill = temperature)) +
  geom_split_violin(alpha = 0.8, show.legend = F) +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()
  ) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "Puls (slag/min)") +
  labs(
    title = "Pulsfordeling for hvert intervalldrag",
    subtitle = paste("<span style='color:#3caae6'>Kald økt</span>", "og",
    "<span style='color:#ed4e4e'>varm økt</span>")
    ) +
  theme(
    plot.title = element_text(size = 10),
    plot.subtitle = element_markdown(size = 8),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_text(size = 8)
  ) +
  scale_fill_brewer(palette = "Set1")

fiolin_plott <- p5

p5
```

```{r}

# Lagre plott

setwd("C:/Users/simen/Desktop/hvgs_des_2023/grafer")

ggsave(hard_intervall_watt_puls_fordeling_split,
       filename = "hard_intervall_watt_puls_fordeling_split.jpg",
       dpi = 300,
       height = 5,
       width = 6)
```
