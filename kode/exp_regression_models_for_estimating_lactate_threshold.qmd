---
title: "Exponential Regression Models for Estimating Lactate Threshold"
author: "Simen Lokken"
format: html
editor: visual
---

### Tema

Dette dokumentet viser hvordan eksponentielle regresjonsmodeller kan brukes for å estimere laktat som en funksjon av fart/watt.

#### Last inn pakker

```{r}

library(tidyverse)
library(gridExtra)
```

#### Lag to datasett

```{r}

df_full <- tibble( # Full data
  fart = c(9, 10, 11, 12, 13, 14, 15),
  laktat = c(1.6, 1.7, 1.9, 2.3, 2.9, 3.2, 6.10))

df_reduced <- tibble( # Reduced data
  fart = c(9, 10, 11, 12, 13, 14),
  laktat = c(1.6, 1.7, 1.9, 2.3, 2.9, 3.2))
```

#### Eksponentiell model for fullt datasett

```{r}

exp_model_lt_full <- lm(log(laktat) ~ fart, data = df_full) # Full model

exp_function_lt_full <- function(x){ # Function for full data
  
  exp(coef(exp_model_lt_full)[1]) * exp(coef(exp_model_lt_full)[2])^x
  
}

exp_function_lt_full(14) # Test function for full data
```

#### Eksponentiell model med redusert datasett

```{r}

# Exponential modelling with reduced data

exp_model_lt_reduced <- lm(log(laktat) ~ fart, data = df_reduced) # Reduced model

exp_function_lt_reduced <- function(x){ # Function for reduced data
  
  exp(coef(exp_model_lt_reduced)[1]) * exp(coef(exp_model_lt_reduced)[2])^x 
  
}

exp_function_lt_reduced(14) # Test function for reduced data
```

Eneste forskjellen mellom de to eksponentielle modellene er at jeg har fjernet målingen på 15 km/t på laktattesten vi bruker som eksempel.

#### Eksponentialplott med fullt datasett

```{r}

full_plot <- df_full |> 
  ggplot(aes(fart, laktat)) +
  geom_point() +
  geom_line(aes(y = exp(predict(exp_model_lt_full)),
                color = "red"), show.legend = F) +
  scale_y_continuous(
    name = "Laktat (mmol/L)",
    breaks = seq(0, 6, 1)
  ) +
  scale_x_continuous(
    name = NULL,
    breaks = seq(9, 15, 1)
    ) +
  labs(title = "Eksponentiell model fra full laktattest") +
  theme_light() +
  theme(panel.grid.major = element_blank())
```

#### Eksponentialplott med redusert datasett

```{r}

reduced_plot <- df_reduced |> 
  ggplot(aes(fart, laktat)) +
  geom_point() +
  geom_line(aes(y = exp(predict(exp_model_lt_reduced)),
                color = "red"), show.legend = F) +
  scale_y_continuous(
    name = "Laktat (mmol/L)",
    breaks = seq(0, 4, 0.25)
  ) +
  scale_x_continuous(
    name = "Fart (km/t)",
    breaks = seq(9, 15, 1)
  ) +
  labs(title = "Eksponentiell model fra modifisert laktattest") +
  theme_light() +
  theme(panel.grid.major = element_blank())
```

#### Slå sammen plott og lagre

```{r, code-fold: TRUE}

full_reduced_plot <- grid.arrange(full_plot, reduced_plot, nrow = 2)
```

```{r}

ggsave(plot = full_reduced_plot,
       filename = "two_exp_reg_for_estimating_lactate_threshold.jpg",
       dpi = 300,
       height = 4,
       width = 8)
```
